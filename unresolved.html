<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8"> 
<title>Issues Resolved Directly</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
</style>
</head>
<body>
<h1>File System TS Issues Resolved Directly In [INSERT CURRENT MEETING HERE]</h1>
<table>
<tr>
<td align="left">Doc. no.</td>
<td align="left">N4???</td>
</tr>
<tr>
<td align="left">Date:</td>
<td align="left"><p>Revised 2014-06-17 at 14:06:48 UTC</p>
</td>
</tr>
<tr>
<td align="left">Project:</td>
<td align="left">Programming Language C++</td>
</tr>
<tr>
<td align="left">Reply to:</td>
<td align="left">Alisdair Meredith &lt;<a href="mailto:lwgchair@gmail.com">lwgchair@gmail.com</a>&gt;</td>
</tr>
</table>
<h2>Immediate Issues</h2>
<hr>
<h3><a name="5"></a>5. [PDTS] Parent of root directory unspecified</h3>
<p><b>Section:</b> X 8.1 [path.generic] <b>Status:</b> <a href="active.html#Immediate">Immediate</a>
 <b>Submitter:</b> CH-4 <b>Opened:</b> 2014-01-20 <b>Last modified:</b> 2014-06-17</p>
<p><b>View all issues with</b> <a href="status-index.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>8.1 [path.generic] says:
"The filename dot-dot is treated as a reference to the parent directory." So it must be
specified what "/.." and "/../.." refer to.</p>

<p>Add a statement what the parent directory of the root directory is.</p>

  <p><i>[2014-02-07, Beman Dawes suggests wording]</i></p>

  
  <p><i>[
    2014-02-11 Issaquah: Implementation defined. See wiki notes for rationale.
    Beman to provide wording for review next meeting.
  ]</i></p>


  <p><i>[
    22 May 2014 Beman provides wording, taken directly from POSIX.
    See pubs.opengroup.org/onlinepubs/9699919799/xrat/V4_xbd_chap04.html#tag_21_04_12
  ]</i></p>




<p><b>Proposed resolution:</b></p>

<ol>
<li>
<p>Change 8.1 [path.generic]:</p>

<blockquote><p>
The filename <i>dot</i> is treated as a reference to the current directory.
The filename <i>dot-dot</i> is treated as a reference to the parent directory.
<ins>What the filename <i>dot-dot</i> refers to relative to <i>root-directory</i> is implementation-defined.</ins>
Specific filenames may have special meanings for a particular operating system.
</p></blockquote>
</li>
</ol>






<hr>
<h3><a name="25"></a>25. [PDTS] Copying equivalent paths effects not specified</h3>
<p><b>Section:</b> X 15.4 [fs.op.copy_file] <b>Status:</b> <a href="active.html#Immediate">Immediate</a>
 <b>Submitter:</b> CH-15 <b>Opened:</b> 2014-01-20 <b>Last modified:</b> 2014-06-17</p>
<p><b>View all issues with</b> <a href="status-index.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>Even if <tt>to</tt> and <tt>from</tt> are different paths, they may be equivalent.</p>

<p>Specify what happens if <tt>(options &amp; copy_options::overwrite_existing)</tt> but <tt>from</tt> and <tt>to</tt>
resolve to the same file.</p>

  <p><i>[2014-02-09, Beman Dawes: Need advice on this issue:]</i></p>


  <p/>What do existing implentations do?

  <p/>Possible resolutions:
  <ol>
    <li>Treat it as an error.</li>
    <li>Once equivalence is determined, take no further action and return true? false?</li>
    <li>Don't bother to detect a file overwriting itself. This will likely result in an error, anyhow.</li>
  </ol>
  <p><i>[2014-02-13 LWG/SG-3 Issaquah: LWG/SG-3 decided to treat equivalence in this case as an error.
  Beman to provide wording.]</i></p>


  <p><i>[2014-04-09 Beman provided wording as requested. The Effects were rewritten to increase
  clarity. Behavior remains unchanged except for treating equivalence as an error.]</i></p>


  <p><i>[17 Jun 2014 Rapperswil LWG moves to Immediate. Jonathan Wakely will provide editorial
  changes to improve the presentation of bitmask values.]</i></p>




<p><b>Proposed resolution:</b></p>
  <p/>
  <i>Change 15.4 [fs.op.copy_file]:</i>

  <blockquote>
    <p>
      <i>Precondition:</i> At most one constant from each <code>copy_options</code>
      option group ([<a href="#enum.copy_options">enum.copy_options</a>]) is present
      in <code>options</code>.
    </p>

    <p>
      <i>Effects:</i>
    </p>
    <blockquote>
      
        <p><del>
          If&nbsp; <code>exists(to) &amp;&amp;</code> <code>
            !(options &amp; (copy_options::skip_existing
            | copy_options::overwrite_existing | copy_options::update_existing))
          </code> report a
          file already exists error as specified in <a href="#Error-reporting">Error reporting (7)</a>.
        </del></p>
      
      
        <p><del>
          If <code>
            !exists(to) || (options &amp; copy_options::overwrite_existing) || ((options &amp; copy_options::update_existing)
            &amp;&amp; last_write_time(from) &gt; last_write_time(to)) || !(options &amp; (copy_options::skip_existing
            | copy_options::overwrite_existing | copy_options::update_existing))
          </code> copy the contents and attributes of the file <code>from</code>
          resolves to  the file <code>to</code> resolves to.
        </del></p>
      
    </blockquote>
    <blockquote>
      
        <p>
          <ins>
            Report a file already exists error as specified in
            <a href="file:///C:/dot16/filesystem-ts/working-draft.html#Error-reporting">
              Error reporting (7)
            </a> if:
          </ins>
        </p>
        <ul>
          <li><ins>
              <ins><code>exists(to)</code> and <code>equivalent(from, to)</code>,
              or</ins>
          </ins></li>
          <li><ins>
              <code>exists(to)</code> and <code>
                (options &amp; (copy_options::skip_existing
                | copy_options::overwrite_existing | copy_options::update_existing)) == copy_options::none.
              </code>
          </ins></li>
        </ul>
        <p><ins>
          Otherwise copy the contents and attributes of the file <code>from</code>
          resolves to the file <code>to</code> resolves to if:
          </ins></p>
        <ul>
          <li><ins>
              <code>!exists(to)</code>, or
          </ins></li>
          <li><ins>
            <code>exists(to)</code> and <code>
              (options &amp;
              copy_options::overwrite_existing) != copy_options::none
            </code>, or
          </ins></li>
          <li><ins>
            <code>exists(to)</code> and <code>
              (options &amp;
              copy_options::update_existing) != copy_options::none
            </code> and <code>from</code> is more
            recent than <code>to</code>, determined as if by use of the <code>
              last_write_time
            </code> function.
          </ins></li>
        </ul>
        <p><ins>Otherwise no effects.</ins></p>
      
    </blockquote>

    <p>
      <i>Returns</i>: <code>true</code> if the <code>from</code> file
      was copied, otherwise <code>false</code>. The signature with argument <code>ec</code> return
      <code>false</code> if an error occurs.
    </p>
    <p>
      <i>Throws:</i> As specified in <a href="#Error-reporting">Error reporting (7)</a>.
    </p>
    <p>
      <i>Complexity:</i> At most one direct or indirect invocation of <code>
        status(to)</code>.
    </p>
  </blockquote>
  





<hr>
<h3><a name="27"></a>27. [PDTS] Return value of <tt>uintmax_t</tt> on error?</h3>
<p><b>Section:</b> X 15.14 [fs.op.file_size] <b>Status:</b> <a href="active.html#Immediate">Immediate</a>
 <b>Submitter:</b> FI-9 <b>Opened:</b> 2014-01-20 <b>Last modified:</b> 2014-06-17</p>
<p><b>View all issues with</b> <a href="status-index.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>"The signature with argument <tt>ec</tt> returns <tt>static_cast&lt;uintmax_t&gt;(-1)</tt> if an error
occurs.", one would expect that <b>both</b> signatures return that if an error occurs?</p>

<p>Clarify the Returns clause, and apply the same for every function that returns an
<tt>uintmax_t</tt> where applicable.</p>
  
 <p><i>[2014-02-13 LWG/SG-3 Issaquah:]</i></p>


  <p/>Discussion when around in circles for a while, until someone suggested the reference to 15.15 was wrong,
  and that the issue applied to the previous function in the WP, 15.14 File size [fs.op.file_size].
  
  <p/>The NB Comment makes much more sense if it applies to file_size(), so the chair was directed
  to change the reference from 15.15 [fs.op.hard_lk_ct] to 15.14 [fs.op.file_size].
  
  <p/>The intent that file_size() is only meaningful for regular_files. Beman to strike the
  the static_cast, changing it to "Otherwise an error is reported.".  
  



<p><b>Proposed resolution:</b></p>
  <p>
    <i>Change 15.14 [fs.op.file_size]:</i>
  </p>

<pre>uintmax_t file_size(const path&amp; p);
uintmax_t file_size(const path&amp; p, error_code&amp; ec) noexcept;</pre>
<blockquote>
  <p><i>Returns:</i> If <code>
    <ins>!</ins>exists(p) <del>&amp;&amp;</del>  <ins>|| !</ins>is_regular_file(p)</code><ins>
      an error is reported (7). Otherwise</ins>, the size in bytes 
  of the file <code>p</code> resolves to, determined as if by the value of the 
  POSIX <code>stat</code> structure member <code>st_size</code> 
  obtained as if by POSIX <code>stat()</code>. 
  <del>Otherwise, <code>static_cast&lt;uintmax_t&gt;(-1)</code>.</del> The signature with 
  argument <code>ec</code> 
  returns <code>static_cast&lt;uintmax_t&gt;(-1)</code> if an error occurs.</p>
  <p><i>Throws:</i> As specified in <a href="#Error-reporting">Error reporting <ins>(7)</ins></a>.</p>
</blockquote>







<hr>
<h3><a name="34"></a>34. 
    [PDTS] <tt>enum class directory_options</tt> has no summary
  </h3>
<p><b>Section:</b> X 6 [fs.filesystem.synopsis] <b>Status:</b> <a href="active.html#Immediate">Immediate</a>
 <b>Submitter:</b> P.J. Plauger <b>Opened:</b> 2014-01-30 <b>Last modified:</b> 2014-06-17</p>
<p><b>View other</b> <a href="open-index.html# [fs.filesystem.synopsis">active issues</a> in 6 [fs.filesystem.synopsis].</p>
<p><b>View all other</b> <a href="section-index.html# [fs.filesystem.synopsis">issues</a> in 6 [fs.filesystem.synopsis].</p>
<p><b>View all issues with</b> <a href="status-index.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p><tt>enum class directory_options</tt> has no summary.</p>


<p><b>Proposed resolution:</b></p>

  <p>
    <i>Change 6 [fs.filesystem.synopsis]:</i>
  </p>
  <blockquote>
    <pre>
      enum class directory_options<ins>;</ins>
      <del>{</del>
      <del>none,</del>
      <del>follow_directory_symlink,</del>
      <del>skip_permission_denied</del>
      <del>};</del></pre>
  </blockquote>
  <p>
    <i>Add the following sub-section:</i>
  </p>
  <blockquote>

    <h3>
      10.4  Enum class <code>directory_options</code> [<a name="enum.directory_options">enum.directory_options</a>]
    </h3>
    <p>
      The <tt>enum class</tt> type <code>directory_options</code>
      is a bitmask type (C++11 §17.5.2.1.3) that specifies bitmask constants used to identify
      directory traversal options.
    </p>
    <table border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111">
      <tr>
        <td>
          <b>Name</b>
        </td>
        <td align="center">
          <b>Value</b>
        </td>
        <td>
          <b>Meaning</b>
        </td>
      </tr>

      <tr>
        <td>
          <code>none</code>
        </td>
        <td align="center">
          <code>0</code>
        </td>
        <td>(Default) Skip directory symlinks, permission denied is error.</td>
      </tr>
      <tr>
        <td>
          <code>follow_directory_symlink</code>
        </td>
        <td align="center">
          <code>1</code>
        </td>
        <td> Follow rather than skip directory symlinks.</td>
      </tr>
      <tr>
        <td>
          <code>skip_permission_denied</code>
        </td>
        <td align="center">
          <code>2</code>
        </td>
        <td> Skip directories that would otherwise result in permission denied errors.</td>
      </tr>

    </table>
  </blockquote>





<hr>
<h3><a name="36"></a>36. [PDTS] <tt>copy_options::copy_symlinks</tt> is not used</h3>
<p><b>Section:</b> X 10.2 [enum.copy_options] <b>Status:</b> <a href="active.html#Immediate">Immediate</a>
 <b>Submitter:</b> P.J. Plauger <b>Opened:</b> 2014-01-30 <b>Last modified:</b> 2014-06-17</p>
<p><b>View all other</b> <a href="section-index.html#0.2 [enum.copy_options">issues</a> in 10.2 [enum.copy_options].</p>
<p><b>View all issues with</b> <a href="status-index.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<tt>copy_options::copy_symlinks</tt> is not used (should test it before calling <tt>copy_symlinks</tt> in <tt>copy</tt>).
</p>
  <p><i>[20 May 2014 Beman Dawes provides proposed wording.]</i></p>



<p><b>Proposed resolution:</b></p>
  <p>
    <i>Change 15.3 Copy [fs.op.copy]:</i>
  </p>
  <blockquote>
    <blockquote>
      <p>
        If <code>is_symlink(f)</code>, then:
      </p>
      <ul>
        <li>
          If <code>options &amp; copy_options::skip_symlinks</code>, then return.&nbsp;
          <span style="font-style: italic; background-color: #C0C0C0">Missing != copy_options::none fixed by issue 59</span>
        </li>
        <li>
          Otherwise if <code>
            !exists(t) <ins>
              &amp;&amp; (options &amp; copy_options::copy_symlinks)
              != copy_options::none
            </ins>
          </code>, then <code>
            copy_symlink(from,
            to, options)
          </code>.
        </li>
        <li>
          Otherwise report an error as specified in
          <a href="file:///C:/dot16/filesystem-ts/issues/mailing/active.html#Error-reporting"
           style="color: #2020FF; text-decoration: none">
            Error reporting (7)
          </a>.
        </li>
      </ul>
    </blockquote>
  </blockquote>





<hr>
<h3><a name="37"></a>37. [PDTS] All functions with <tt>error_code</tt> arguments should be <tt>noexcept</tt></h3>
<p><b>Section:</b> X 15.2 [fs.op.canonical], X 15.11 [fs.op.current_path], X 15.27 [fs.op.read_symlink], X 15.36 [fs.op.system_complete], X 15.37 [fs.op.temp_dir_path], X 15.38 [fs.op.unique_path], X 8.4 [path.member] <b>Status:</b> <a href="active.html#Immediate">Immediate</a>
 <b>Submitter:</b> P.J. Plauger <b>Opened:</b> 2014-01-30 <b>Last modified:</b> 2014-06-17</p>
<p><b>View all issues with</b> <a href="status-index.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
all functions with <tt>error_code</tt> arguments should be <tt>noexcept</tt>
(see <tt>canonical</tt>, <tt>current_path</tt>, <tt>read_symlink</tt>, <tt>system_complete</tt>,
<tt>temp_directory_path</tt>, <tt>unique_path</tt>, plus member functions).
</p>
<p><i>[2014-02-03: Stephan T. Lavavej comments:]</i></p>
<p>The declaration and definition of
"<tt>recursive_directory_iterator&amp; increment(error_code&amp; ec);</tt>" should almost certainly
be marked noexcept.</p>

<p><i>[2014-02-08: Daniel comments]</i></p>

<p>
All functions that return a <tt>path</tt> value such as <tt>canonical</tt>, <tt>current_path</tt>,
<tt>read_symlink</tt>, <tt>system_complete</tt>, <tt>temp_directory_path</tt>, <tt>unique_path</tt>,
or any member function returning a <tt>path</tt> value or <tt>basic_string</tt> value might legally 
throw an exception, if the allocator of the underlying string complains about insufficient 
memory. This is an anti-pattern for <tt>noexcept</tt>, because the exception-specification includes 
the return statement of a function and given the fact that the language currently does declare RVO
as an optional action, we cannot rely on it.
<p/>
The Standard is currently very careful <em>not</em> to specify functions as <tt>noexcept</tt>,
if this case can happen, see e.g. <tt>std::locale::name()</tt>. To the contrary, enforcing them to be
<tt>noexcept</tt>, would cause a similar problem as the unconditional <tt>noexcept</tt> specifier of
the value-returning <tt>kill_dependency</tt> as denoted by LWG 2236.
<p/>
Basically this requirement conflicts with the section "Adopted Guidelines", second bullet of
<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2011/n3279.pdf">N3279</a>.
</p>

<p><i>[Beman Dawes 2014-02-27]</i></p>


<p/>Issues <a href="active.html#37">37</a>,
<a href="active.html#38">38</a>,
<a href="active.html#41">41</a>,
and <a href="active.html#49">49</a> are concerned with signatures which should or should not
be <tt>noexcept</tt>. I will provide unified proposed wording for these issues, possibly in a separate paper.

<p><i>[21 May 2014 Beman Dawes reviewed all functions with <code>error_code&amp;</code> arguments,
  and provided proposed wording for the one case found where the above guidelines were not met.
  This was the case previously identified by Stephan T. Lavavej.
]</i></p>




<p><b>Proposed resolution:</b></p>
  <p>
    <i>Change 14 Class recursive_directory_iterator [class.rec.dir.itr]:</i>
  </p>
  <blockquote>
    <pre>recursive_directory_iterator&amp; increment(error_code&amp; ec) <ins>noexcept</ins>;</pre>
  </blockquote>
  <p>
    <i>Change 14.1 recursive_directory_iterator members [rec.dir.itr.members]:</i>
  </p>
  <blockquote>
    <pre>recursive_directory_iterator&amp; increment(error_code&amp; ec) <ins>noexcept</ins>;</pre>
  </blockquote>





<hr>
<h3><a name="40"></a>40. [PDTS] <tt>class directory_entry</tt> should retain <tt>operator const path&amp;()</tt> from V2</h3>
<p><b>Section:</b> X 12 [class.directory_entry] <b>Status:</b> <a href="active.html#Immediate">Immediate</a>
 <b>Submitter:</b> P.J. Plauger <b>Opened:</b> 2014-01-30 <b>Last modified:</b> 2014-06-17</p>
<p><b>View other</b> <a href="open-index.html#2 [class.directory_entry">active issues</a> in 12 [class.directory_entry].</p>
<p><b>View all other</b> <a href="section-index.html#2 [class.directory_entry">issues</a> in 12 [class.directory_entry].</p>
<p><b>View all issues with</b> <a href="status-index.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>  
<tt>class directory_entry</tt> should retain <tt>operator const path&amp;()</tt> from V2.
</p>

  <p><i>[2014-05-19 Beman Dawes supplied proposed wording.]</i></p>

  <p><i>[2014-06-02 Beman Dawes provides rationale:]</i></p>

  <blockquote>
    This conversion operator was removed when <code>status()</code> and <code>symlink_status()</code>
    were added during the transition from V2 to V3 as it seemed a bit unusual to have a conversion
    operator for one of the several values held. Users complained as they had found the
    automatic conversion convenient in the most common <code>directory_entry</code> use case.
  </blockquote>
  <p><i>[17 Jun 2014 Rapperswil LWG discusses in depth, accepts proposed wording.]</i></p>
  


<p><b>Proposed resolution:</b></p>
  <p>
    <i>Change 12 Class directory_entry [class.directory_entry]:</i>
  </p>
  <blockquote>
    <pre>// observers
const path&amp;  path() const noexcept;
<ins>operator const path&amp;() const noexcept;</ins>
file_status  status() const;
file_status  status(error_code&amp; ec) const noexcept;
file_status  symlink_status() const;
file_status  symlink_status(error_code&amp; ec) const noexcept;</pre>
  </blockquote>

  <p>
    <i>Change 12.3 directory_entry observers [directory_entry.obs]:</i>
  </p>
  <blockquote>
    <pre>const path&amp; path() const noexcept;
<ins>operator const path&amp;() const noexcept;</ins></pre>
    <blockquote>
      <p>
        <i>Returns:</i>
        <code>m_path</code>
      </p>
    </blockquote>
  </blockquote>






<hr>
<h3><a name="45"></a>45. 
[PDTS] <tt>create_directory</tt> should refer to <tt>perms::all</tt> instead of Posix
<tt>S_IRWXU|S_IRWXG|S_IRWXO</tt>
</h3>
<p><b>Section:</b> X 15.7 [fs.op.create_directory] <b>Status:</b> <a href="active.html#Immediate">Immediate</a>
 <b>Submitter:</b> P.J. Plauger <b>Opened:</b> 2014-01-30 <b>Last modified:</b> 2014-06-17</p>
<p><b>View all issues with</b> <a href="status-index.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<tt>create_directory</tt> should refer to <tt>perms::all</tt> instead of the Posix
<tt>S_IRWXU|S_IRWXG|S_IRWXO</tt>.
</p>
<p><i>[2014-02-28 Beman provided proposed wording.]</i></p>



<p><b>Proposed resolution:</b></p>
<p><i>Effects:</i> Establishes the postcondition by attempting to create the 
  directory <code>p</code> resolves to, as if by POSIX <code>
  mkdir()</code> with a second argument of <del>S_IRWXU|S_IRWXG|S_IRWXO</del> <ins><code>static_cast&lt;int&gt;(perms::all)</code></ins>. Creation 
  failure because <code>p</code> resolves to an existing directory shall not be 
  treated as an error. </p>






</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8"> 
<title>Issues Resolved Directly</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
</style>
</head>
<body>
<h1>File System TS Issues Resolved Directly In [INSERT CURRENT MEETING HERE]</h1>
<table>
<tr>
<td align="left">Doc. no.</td>
<td align="left">N4???</td>
</tr>
<tr>
<td align="left">Date:</td>
<td align="left"><p>Revised 2014-06-19 at 04:06:21 UTC</p>
</td>
</tr>
<tr>
<td align="left">Project:</td>
<td align="left">Programming Language C++</td>
</tr>
<tr>
<td align="left">Reply to:</td>
<td align="left">Alisdair Meredith &lt;<a href="mailto:lwgchair@gmail.com">lwgchair@gmail.com</a>&gt;</td>
</tr>
</table>
<h2>Immediate Issues</h2>
<hr>
<h3><a name="25"></a>25. [PDTS] Copying equivalent paths effects not specified</h3>
<p><b>Section:</b> X 15.4 [fs.op.copy_file] <b>Status:</b> <a href="active.html#Immediate">Immediate</a>
 <b>Submitter:</b> CH-15 <b>Opened:</b> 2014-01-20 <b>Last modified:</b> 2014-06-17</p>
<p><b>View all issues with</b> <a href="status-index.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>Even if <tt>to</tt> and <tt>from</tt> are different paths, they may be equivalent.</p>

<p>Specify what happens if <tt>(options &amp; copy_options::overwrite_existing)</tt> but <tt>from</tt> and <tt>to</tt>
resolve to the same file.</p>

  <p><i>[2014-02-09, Beman Dawes: Need advice on this issue:]</i></p>


  <p/>What do existing implentations do?

  <p/>Possible resolutions:
  <ol>
    <li>Treat it as an error.</li>
    <li>Once equivalence is determined, take no further action and return true? false?</li>
    <li>Don't bother to detect a file overwriting itself. This will likely result in an error, anyhow.</li>
  </ol>
  <p><i>[2014-02-13 LWG/SG-3 Issaquah: LWG/SG-3 decided to treat equivalence in this case as an error.
  Beman to provide wording.]</i></p>


  <p><i>[2014-04-09 Beman provided wording as requested. The Effects were rewritten to increase
  clarity. Behavior remains unchanged except for treating equivalence as an error.]</i></p>


  <p><i>[17 Jun 2014 Rapperswil LWG moves to Immediate. Jonathan Wakely will provide editorial
  changes to improve the presentation of bitmask values.]</i></p>




<p><b>Proposed resolution:</b></p>
  <p/>
  <i>Change 15.4 [fs.op.copy_file]:</i>

  <blockquote>
    <p>
      <i>Precondition:</i> At most one constant from each <code>copy_options</code>
      option group ([<a href="#enum.copy_options">enum.copy_options</a>]) is present
      in <code>options</code>.
    </p>

    <p>
      <i>Effects:</i>
    </p>
    <blockquote>
      
        <p><del>
          If&nbsp; <code>exists(to) &amp;&amp;</code> <code>
            !(options &amp; (copy_options::skip_existing
            | copy_options::overwrite_existing | copy_options::update_existing))
          </code> report a
          file already exists error as specified in <a href="#Error-reporting">Error reporting (7)</a>.
        </del></p>
      
      
        <p><del>
          If <code>
            !exists(to) || (options &amp; copy_options::overwrite_existing) || ((options &amp; copy_options::update_existing)
            &amp;&amp; last_write_time(from) &gt; last_write_time(to)) || !(options &amp; (copy_options::skip_existing
            | copy_options::overwrite_existing | copy_options::update_existing))
          </code> copy the contents and attributes of the file <code>from</code>
          resolves to  the file <code>to</code> resolves to.
        </del></p>
      
    </blockquote>
    <blockquote>
      
        <p>
          <ins>
            Report a file already exists error as specified in
            <a href="file:///C:/dot16/filesystem-ts/working-draft.html#Error-reporting">
              Error reporting (7)
            </a> if:
          </ins>
        </p>
        <ul>
          <li><ins>
              <ins><code>exists(to)</code> and <code>equivalent(from, to)</code>,
              or</ins>
          </ins></li>
          <li><ins>
              <code>exists(to)</code> and <code>
                (options &amp; (copy_options::skip_existing
                | copy_options::overwrite_existing | copy_options::update_existing)) == copy_options::none.
              </code>
          </ins></li>
        </ul>
        <p><ins>
          Otherwise copy the contents and attributes of the file <code>from</code>
          resolves to the file <code>to</code> resolves to if:
          </ins></p>
        <ul>
          <li><ins>
              <code>!exists(to)</code>, or
          </ins></li>
          <li><ins>
            <code>exists(to)</code> and <code>
              (options &amp;
              copy_options::overwrite_existing) != copy_options::none
            </code>, or
          </ins></li>
          <li><ins>
            <code>exists(to)</code> and <code>
              (options &amp;
              copy_options::update_existing) != copy_options::none
            </code> and <code>from</code> is more
            recent than <code>to</code>, determined as if by use of the <code>
              last_write_time
            </code> function.
          </ins></li>
        </ul>
        <p><ins>Otherwise no effects.</ins></p>
      
    </blockquote>

    <p>
      <i>Returns</i>: <code>true</code> if the <code>from</code> file
      was copied, otherwise <code>false</code>. The signature with argument <code>ec</code> return
      <code>false</code> if an error occurs.
    </p>
    <p>
      <i>Throws:</i> As specified in <a href="#Error-reporting">Error reporting (7)</a>.
    </p>
    <p>
      <i>Complexity:</i> At most one direct or indirect invocation of <code>
        status(to)</code>.
    </p>
  </blockquote>
  





<hr>
<h3><a name="40"></a>40. [PDTS] <tt>class directory_entry</tt> should retain <tt>operator const path&amp;()</tt> from V2</h3>
<p><b>Section:</b> X 12 [class.directory_entry] <b>Status:</b> <a href="active.html#Immediate">Immediate</a>
 <b>Submitter:</b> P.J. Plauger <b>Opened:</b> 2014-01-30 <b>Last modified:</b> 2014-06-17</p>
<p><b>View other</b> <a href="open-index.html#2 [class.directory_entry">active issues</a> in 12 [class.directory_entry].</p>
<p><b>View all other</b> <a href="section-index.html#2 [class.directory_entry">issues</a> in 12 [class.directory_entry].</p>
<p><b>View all issues with</b> <a href="status-index.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>  
<tt>class directory_entry</tt> should retain <tt>operator const path&amp;()</tt> from V2.
</p>

  <p><i>[2014-05-19 Beman Dawes supplied proposed wording.]</i></p>

  <p><i>[2014-06-02 Beman Dawes provides rationale:]</i></p>

  <blockquote>
    This conversion operator was removed when <code>status()</code> and <code>symlink_status()</code>
    were added during the transition from V2 to V3 as it seemed a bit unusual to have a conversion
    operator for one of the several values held. Users complained as they had found the
    automatic conversion convenient in the most common <code>directory_entry</code> use case.
  </blockquote>
  <p><i>[17 Jun 2014 Rapperswil LWG discusses in depth, accepts proposed wording.]</i></p>
  


<p><b>Proposed resolution:</b></p>
  <p>
    <i>Change 12 Class directory_entry [class.directory_entry]:</i>
  </p>
  <blockquote>
    <pre>// observers
const path&amp;  path() const noexcept;
<ins>operator const path&amp;() const noexcept;</ins>
file_status  status() const;
file_status  status(error_code&amp; ec) const noexcept;
file_status  symlink_status() const;
file_status  symlink_status(error_code&amp; ec) const noexcept;</pre>
  </blockquote>

  <p>
    <i>Change 12.3 directory_entry observers [directory_entry.obs]:</i>
  </p>
  <blockquote>
    <pre>const path&amp; path() const noexcept;
<ins>operator const path&amp;() const noexcept;</ins></pre>
    <blockquote>
      <p>
        <i>Returns:</i>
        <code>m_path</code>
      </p>
    </blockquote>
  </blockquote>






</body>
</html>

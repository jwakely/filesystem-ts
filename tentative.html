<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8"> 
<title>Tentative Issues</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
</style>
</head>
<body>
<p><p>Revised 2014-06-19 at 03:06:33 UTC</p>
</p><h2>Tentative Issues</h2>
<hr>
<h3><a name="5"></a>5. [PDTS] Parent of root directory unspecified</h3>
<p><b>Section:</b> X 8.1 [path.generic] <b>Status:</b> <a href="active.html#Immediate">Tentatively Immediate</a>
 <b>Submitter:</b> CH-4 <b>Opened:</b> 2014-01-20 <b>Last modified:</b> 2014-06-18</p>
<p><b>View all issues with</b> <a href="status-index.html#Tentatively Immediate">Tentatively Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>8.1 [path.generic] says:
"The filename dot-dot is treated as a reference to the parent directory." So it must be
specified what "/.." and "/../.." refer to.</p>

<p>Add a statement what the parent directory of the root directory is.</p>

  <p><i>[2014-02-07, Beman Dawes suggests wording]</i></p>

  
  <p><i>[
    2014-02-11 Issaquah: Implementation defined. See wiki notes for rationale.
    Beman to provide wording for review next meeting.
  ]</i></p>


  <p><i>[
    22 May 2014 Beman provides wording, taken directly from POSIX.
    See pubs.opengroup.org/onlinepubs/9699919799/xrat/V4_xbd_chap04.html#tag_21_04_12
  ]</i></p>




<p><b>Proposed resolution:</b></p>

<ol>
<li>
<p>Change 8.1 [path.generic]:</p>

<blockquote><p>
The filename <i>dot</i> is treated as a reference to the current directory.
The filename <i>dot-dot</i> is treated as a reference to the parent directory.
<ins>What the filename <i>dot-dot</i> refers to relative to <i>root-directory</i> is implementation-defined.</ins>
Specific filenames may have special meanings for a particular operating system.
</p></blockquote>
</li>
</ol>






<hr>
<h3><a name="27"></a>27. [PDTS] Return value of <tt>uintmax_t</tt> on error?</h3>
<p><b>Section:</b> X 15.14 [fs.op.file_size] <b>Status:</b> <a href="active.html#Immediate">Tentatively Immediate</a>
 <b>Submitter:</b> FI-9 <b>Opened:</b> 2014-01-20 <b>Last modified:</b> 2014-06-18</p>
<p><b>View all issues with</b> <a href="status-index.html#Tentatively Immediate">Tentatively Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>"The signature with argument <tt>ec</tt> returns <tt>static_cast&lt;uintmax_t&gt;(-1)</tt> if an error
occurs.", one would expect that <b>both</b> signatures return that if an error occurs?</p>

<p>Clarify the Returns clause, and apply the same for every function that returns an
<tt>uintmax_t</tt> where applicable.</p>
  
 <p><i>[2014-02-13 LWG/SG-3 Issaquah:]</i></p>


  <p/>Discussion when around in circles for a while, until someone suggested the reference to 15.15 was wrong,
  and that the issue applied to the previous function in the WP, 15.14 File size [fs.op.file_size].
  
  <p/>The NB Comment makes much more sense if it applies to file_size(), so the chair was directed
  to change the reference from 15.15 [fs.op.hard_lk_ct] to 15.14 [fs.op.file_size].
  
  <p/>The intent that file_size() is only meaningful for regular_files. Beman to strike the
  the static_cast, changing it to "Otherwise an error is reported.".  
  



<p><b>Proposed resolution:</b></p>
  <p>
    <i>Change 15.14 [fs.op.file_size]:</i>
  </p>

<pre>uintmax_t file_size(const path&amp; p);
uintmax_t file_size(const path&amp; p, error_code&amp; ec) noexcept;</pre>
<blockquote>
  <p><i>Returns:</i> If <code>
    <ins>!</ins>exists(p) <del>&amp;&amp;</del>  <ins>|| !</ins>is_regular_file(p)</code><ins>
      an error is reported (7). Otherwise</ins>, the size in bytes 
  of the file <code>p</code> resolves to, determined as if by the value of the 
  POSIX <code>stat</code> structure member <code>st_size</code> 
  obtained as if by POSIX <code>stat()</code>. 
  <del>Otherwise, <code>static_cast&lt;uintmax_t&gt;(-1)</code>.</del> The signature with 
  argument <code>ec</code> 
  returns <code>static_cast&lt;uintmax_t&gt;(-1)</code> if an error occurs.</p>
  <p><i>Throws:</i> As specified in <a href="#Error-reporting">Error reporting <ins>(7)</ins></a>.</p>
</blockquote>







<hr>
<h3><a name="34"></a>34. 
    [PDTS] <tt>enum class directory_options</tt> has no summary
  </h3>
<p><b>Section:</b> X 6 [fs.filesystem.synopsis] <b>Status:</b> <a href="active.html#Immediate">Tentatively Immediate</a>
 <b>Submitter:</b> P.J. Plauger <b>Opened:</b> 2014-01-30 <b>Last modified:</b> 2014-06-18</p>
<p><b>View other</b> <a href="open-index.html# [fs.filesystem.synopsis">active issues</a> in 6 [fs.filesystem.synopsis].</p>
<p><b>View all other</b> <a href="section-index.html# [fs.filesystem.synopsis">issues</a> in 6 [fs.filesystem.synopsis].</p>
<p><b>View all issues with</b> <a href="status-index.html#Tentatively Immediate">Tentatively Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p><tt>enum class directory_options</tt> has no summary.</p>


<p><b>Proposed resolution:</b></p>

  <p>
    <i>Change 6 [fs.filesystem.synopsis]:</i>
  </p>
  <blockquote>
    <pre>
      enum class directory_options<ins>;</ins>
      <del>{</del>
      <del>none,</del>
      <del>follow_directory_symlink,</del>
      <del>skip_permission_denied</del>
      <del>};</del></pre>
  </blockquote>
  <p>
    <i>Add the following sub-section:</i>
  </p>
  <blockquote>

    <h3>
      10.4  Enum class <code>directory_options</code> [<a name="enum.directory_options">enum.directory_options</a>]
    </h3>
    <p>
      The <tt>enum class</tt> type <code>directory_options</code>
      is a bitmask type (C++11 §17.5.2.1.3) that specifies bitmask constants used to identify
      directory traversal options.
    </p>
    <table border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111">
      <tr>
        <td>
          <b>Name</b>
        </td>
        <td align="center">
          <b>Value</b>
        </td>
        <td>
          <b>Meaning</b>
        </td>
      </tr>

      <tr>
        <td>
          <code>none</code>
        </td>
        <td align="center">
          <code>0</code>
        </td>
        <td>(Default) Skip directory symlinks, permission denied is error.</td>
      </tr>
      <tr>
        <td>
          <code>follow_directory_symlink</code>
        </td>
        <td align="center">
          <code>1</code>
        </td>
        <td> Follow rather than skip directory symlinks.</td>
      </tr>
      <tr>
        <td>
          <code>skip_permission_denied</code>
        </td>
        <td align="center">
          <code>2</code>
        </td>
        <td> Skip directories that would otherwise result in permission denied errors.</td>
      </tr>

    </table>
  </blockquote>





<hr>
<h3><a name="36"></a>36. [PDTS] <tt>copy_options::copy_symlinks</tt> is not used</h3>
<p><b>Section:</b> X 10.2 [enum.copy_options] <b>Status:</b> <a href="active.html#Immediate">Tentatively Immediate</a>
 <b>Submitter:</b> P.J. Plauger <b>Opened:</b> 2014-01-30 <b>Last modified:</b> 2014-06-18</p>
<p><b>View all other</b> <a href="section-index.html#0.2 [enum.copy_options">issues</a> in 10.2 [enum.copy_options].</p>
<p><b>View all issues with</b> <a href="status-index.html#Tentatively Immediate">Tentatively Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<tt>copy_options::copy_symlinks</tt> is not used (should test it before calling <tt>copy_symlinks</tt> in <tt>copy</tt>).
</p>
  <p><i>[20 May 2014 Beman Dawes provides proposed wording.]</i></p>



<p><b>Proposed resolution:</b></p>
  <p>
    <i>Change 15.3 Copy [fs.op.copy]:</i>
  </p>
  <blockquote>
    <blockquote>
      <p>
        If <code>is_symlink(f)</code>, then:
      </p>
      <ul>
        <li>
          If <code>options &amp; copy_options::skip_symlinks</code>, then return.&nbsp;
          <span style="font-style: italic; background-color: #C0C0C0">Missing != copy_options::none fixed by issue 59</span>
        </li>
        <li>
          Otherwise if <code>
            !exists(t) <ins>
              &amp;&amp; (options &amp; copy_options::copy_symlinks)
              != copy_options::none
            </ins>
          </code>, then <code>
            copy_symlink(from,
            to, options)
          </code>.
        </li>
        <li>
          Otherwise report an error as specified in
          <a href="file:///C:/dot16/filesystem-ts/issues/mailing/active.html#Error-reporting"
           style="color: #2020FF; text-decoration: none">
            Error reporting (7)
          </a>.
        </li>
      </ul>
    </blockquote>
  </blockquote>





<hr>
<h3><a name="37"></a>37. [PDTS] All functions with <tt>error_code</tt> arguments should be <tt>noexcept</tt></h3>
<p><b>Section:</b> X 15.2 [fs.op.canonical], X 15.11 [fs.op.current_path], X 15.27 [fs.op.read_symlink], X 15.36 [fs.op.system_complete], X 15.37 [fs.op.temp_dir_path], X 15.38 [fs.op.unique_path], X 8.4 [path.member] <b>Status:</b> <a href="active.html#Immediate">Tentatively Immediate</a>
 <b>Submitter:</b> P.J. Plauger <b>Opened:</b> 2014-01-30 <b>Last modified:</b> 2014-06-18</p>
<p><b>View all issues with</b> <a href="status-index.html#Tentatively Immediate">Tentatively Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
all functions with <tt>error_code</tt> arguments should be <tt>noexcept</tt>
(see <tt>canonical</tt>, <tt>current_path</tt>, <tt>read_symlink</tt>, <tt>system_complete</tt>,
<tt>temp_directory_path</tt>, <tt>unique_path</tt>, plus member functions).
</p>
<p><i>[2014-02-03: Stephan T. Lavavej comments:]</i></p>
<p>The declaration and definition of
"<tt>recursive_directory_iterator&amp; increment(error_code&amp; ec);</tt>" should almost certainly
be marked noexcept.</p>

<p><i>[2014-02-08: Daniel comments]</i></p>

<p>
All functions that return a <tt>path</tt> value such as <tt>canonical</tt>, <tt>current_path</tt>,
<tt>read_symlink</tt>, <tt>system_complete</tt>, <tt>temp_directory_path</tt>, <tt>unique_path</tt>,
or any member function returning a <tt>path</tt> value or <tt>basic_string</tt> value might legally 
throw an exception, if the allocator of the underlying string complains about insufficient 
memory. This is an anti-pattern for <tt>noexcept</tt>, because the exception-specification includes 
the return statement of a function and given the fact that the language currently does declare RVO
as an optional action, we cannot rely on it.
<p/>
The Standard is currently very careful <em>not</em> to specify functions as <tt>noexcept</tt>,
if this case can happen, see e.g. <tt>std::locale::name()</tt>. To the contrary, enforcing them to be
<tt>noexcept</tt>, would cause a similar problem as the unconditional <tt>noexcept</tt> specifier of
the value-returning <tt>kill_dependency</tt> as denoted by LWG 2236.
<p/>
Basically this requirement conflicts with the section "Adopted Guidelines", second bullet of
<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2011/n3279.pdf">N3279</a>.
</p>

<p><i>[Beman Dawes 2014-02-27]</i></p>


<p/>Issues <a href="active.html#37">37</a>,
<a href="active.html#38">38</a>,
<a href="active.html#41">41</a>,
and <a href="active.html#49">49</a> are concerned with signatures which should or should not
be <tt>noexcept</tt>. I will provide unified proposed wording for these issues, possibly in a separate paper.

<p><i>[21 May 2014 Beman Dawes reviewed all functions with <code>error_code&amp;</code> arguments,
  and provided proposed wording for the one case found where the above guidelines were not met.
  This was the case previously identified by Stephan T. Lavavej.
]</i></p>




<p><b>Proposed resolution:</b></p>
  <p>
    <i>Change 14 Class recursive_directory_iterator [class.rec.dir.itr]:</i>
  </p>
  <blockquote>
    <pre>recursive_directory_iterator&amp; increment(error_code&amp; ec) <ins>noexcept</ins>;</pre>
  </blockquote>
  <p>
    <i>Change 14.1 recursive_directory_iterator members [rec.dir.itr.members]:</i>
  </p>
  <blockquote>
    <pre>recursive_directory_iterator&amp; increment(error_code&amp; ec) <ins>noexcept</ins>;</pre>
  </blockquote>





<hr>
<h3><a name="45"></a>45. 
[PDTS] <tt>create_directory</tt> should refer to <tt>perms::all</tt> instead of Posix
<tt>S_IRWXU|S_IRWXG|S_IRWXO</tt>
</h3>
<p><b>Section:</b> X 15.7 [fs.op.create_directory] <b>Status:</b> <a href="active.html#Immediate">Tentatively Immediate</a>
 <b>Submitter:</b> P.J. Plauger <b>Opened:</b> 2014-01-30 <b>Last modified:</b> 2014-06-18</p>
<p><b>View all issues with</b> <a href="status-index.html#Tentatively Immediate">Tentatively Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<tt>create_directory</tt> should refer to <tt>perms::all</tt> instead of the Posix
<tt>S_IRWXU|S_IRWXG|S_IRWXO</tt>.
</p>
<p><i>[2014-02-28 Beman provided proposed wording.]</i></p>



<p><b>Proposed resolution:</b></p>
<p><i>Effects:</i> Establishes the postcondition by attempting to create the 
  directory <code>p</code> resolves to, as if by POSIX <code>
  mkdir()</code> with a second argument of <del>S_IRWXU|S_IRWXG|S_IRWXO</del> <ins><code>static_cast&lt;int&gt;(perms::all)</code></ins>. Creation 
  failure because <code>p</code> resolves to an existing directory shall not be 
  treated as an error. </p>






<hr>
<h3><a name="57"></a>57. [PDTS] Inappropriate use of "No diagnostic is required"</h3>
<p><b>Section:</b> X 2.1 [fs.conform.9945] <b>Status:</b> <a href="active.html#Immediate">Tentatively Immediate</a>
 <b>Submitter:</b> LWG/SG-3 <b>Opened:</b> 2014-02-13 <b>Last modified:</b> 2014-06-19</p>
<p><b>View all other</b> <a href="section-index.html#.1 [fs.conform.9945">issues</a> in 2.1 [fs.conform.9945].</p>
<p><b>View all issues with</b> <a href="status-index.html#Tentatively Immediate">Tentatively Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p/>§ 2.1 [fs.conform.9945] specifes "No diagnostic is required" for races. That prescription is
used by the standard for the core language; it is not appropriate in library specifications.
LWG/SG-3 wishes this be changed to undefined behavior.

<p><i>[Beman comments: The replacment wording is similar to that used by C++14 17.6.4.10]</i></p>



<p><b>Proposed resolution:</b></p>
<p/>Change the following paragraph from § 2.1 [fs.conform.9945]
<blockquote>
<del>The behavior of functions described in this Technical Specification may differ
from their specification in the presence of file system races ([fs.def.race]).
No diagnostic is required.</del>
<p/><ins>Behavior is undefined if calls to functions provided
by this Technical Specification introduce a file system race (4.6 [fs.def.race]).</ins>
</blockquote>

<p/>Insert a new sub-section head before the modified paragraph:
<blockquote>2.1 File system race behavior [fs.race.behavior]</blockquote>






<hr>
<h3><a name="60"></a>60. [PDTS] Incorrect <i>Throws</i> specification for <tt>absolute()</tt></h3>
<p><b>Section:</b> X 15.1 [fs.op.absolute] <b>Status:</b> <a href="active.html#Immediate">Tentatively Immediate</a>
 <b>Submitter:</b> Daniel Krügler <b>Opened:</b> 2014-02-28 <b>Last modified:</b> 2014-06-19</p>
<p><b>View all issues with</b> <a href="status-index.html#Tentatively Immediate">Tentatively Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>The <i>Throws</i> element [fs.op.absolute] says:</p>
<blockquote>
  <p>&quot;If <code>base.is_absolute()</code> is true, throws only if memory 
  allocation fails.&quot;</p>
</blockquote>
<p>We can strike:</p>
<blockquote>
  <p>&quot;If <code>base.is_absolute()</code> is true,&quot; and the wording will still 
  hold. Note that:</p>
  <ol>
    <li>None of the involved functions has requirements.</li>
    <li>In *every* case potentially memory allocation occurs, even for &quot;<code>return 
    p</code>&quot;, so this allocation can fail.</li>
  </ol>
</blockquote>

<p><i>[02-03-2014 Beman Dawes comments and provides P/R]</i></p>


<p/>The <i>Throws</i> element should follow the same form as similar <i>Throws</i>
elements in the TS. There isn't enough special about this function to justify special
wording and by referencing Error reporting (7) we ensure <tt>absolute()</tt> follows
the overall policy for handling memory allocation failures.



<p><b>Proposed resolution:</b></p>
<p><i>[Change 15.1 [fs.op.absolute]:]</i></p>


<blockquote>
  <p><i>Throws:</i> <del>If <code>base.is_absolute()</code> is true, throws only if 
  memory allocation fails.</del> <ins>As specified in <a href="#Error-reporting">Error reporting (7)</a>.</ins></p>
</blockquote>
  





<hr>
<h3><a name="62"></a>62. Allocator requirements unspecified</h3>
<p><b>Section:</b> X 5 Requirements [fs.req] <b>Status:</b> <a href="active.html#Immediate">Tentatively Immediate</a>
 <b>Submitter:</b> Daniel Krügler <b>Opened:</b> 2014-05-19 <b>Last modified:</b> 2014-06-19</p>
<p><b>View all issues with</b> <a href="status-index.html#Tentatively Immediate">Tentatively Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
  The SG3 WP refers in several places to a template parameter named "Allocator" but
  does not impose requirements on this type.
</p>


<p><b>Proposed resolution:</b></p>
<p><i>Add the following to 5 Requirements [fs.req]:</i></p>

  <blockquote>
    <p>
      <ins>Template parameters named <code>Allocator</code> shall meet the C++ Standard's
      library Allocator requirements (C++11 §17.6.3.5)</ins></p>
  </blockquote>  





</body>
</html>
